# 项目启动说明

## 方式一：Docker Compose 启动（推荐）

### 前提条件
- Docker Desktop 已安装并运行
- 网络可以访问 Docker Hub

### 启动步骤
```bash
# 1. 启动所有服务
docker-compose up -d

# 2. 查看服务状态
docker-compose ps

# 3. 查看日志
docker-compose logs -f

# 4. 停止服务
docker-compose down
```

### 访问地址
- 前端：http://localhost:3000
- 后端API：http://localhost:8000
- API文档：http://localhost:8000/docs

---

## 方式二：本地开发启动

### 前提条件
- Python 3.11+
- Node.js 18+
- PostgreSQL 数据库（本地或远程）

### 1. 启动数据库

如果没有本地 PostgreSQL，可以使用 Docker 单独启动数据库：
```bash
docker run -d \
  --name mnr-crawler-db \
  -e POSTGRES_DB=mnr_crawler \
  -e POSTGRES_USER=mnr_user \
  -e POSTGRES_PASSWORD=mnr_password \
  -p 5432:5432 \
  -v postgres_data:/var/lib/postgresql/data \
  postgres:15-alpine
```

### 2. 启动后端

```bash
# 进入后端目录
cd backend

# 创建虚拟环境（如果还没有）
python -m venv .venv

# 激活虚拟环境
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 方式一：使用远程测试数据库（推荐用于测试）
$env:DATABASE_URL="postgresql://test:6p6deyczXK55FYQN@43.143.43.251:5432/test"

# 方式二：使用本地数据库（需要先启动 PostgreSQL）
# $env:DATABASE_URL="postgresql://mnr_user:mnr_password@localhost:5432/mnr_crawler"

# 设置 JWT 密钥
$env:JWT_SECRET_KEY="your-secret-key-change-in-production"

# 运行数据库迁移（首次启动时）
alembic upgrade head

# 启动后端服务
python -m app
# 或者
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**注意**：如果使用 `.env` 文件配置，已在 `backend/.env` 中配置了远程测试数据库连接信息。

### 3. 启动前端

```bash
# 打开新的终端窗口，进入前端目录
cd frontend

# 安装依赖（如果还没有）
npm install

# 启动开发服务器
npm run dev
```

### 访问地址
- 前端：http://localhost:3000
- 后端API：http://localhost:8000
- API文档：http://localhost:8000/docs

---

## 首次启动配置

### 1. 创建默认管理员用户

后端启动后，可以通过 API 创建用户：
```bash
curl -X POST "http://localhost:8000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123",
    "email": "admin@example.com"
  }'
```

或者直接访问前端页面进行注册。

### 2. 配置环境变量（可选）

在项目根目录或 backend 目录创建 `.env` 文件：
```env
DATABASE_URL=postgresql://mnr_user:mnr_password@localhost:5432/mnr_crawler
JWT_SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
DEBUG=false
LOG_LEVEL=INFO
```

---

## 常见问题

### 1. 数据库连接失败
- 检查 PostgreSQL 是否正在运行
- 检查数据库配置是否正确
- 检查防火墙设置

### 2. 端口被占用
- 修改 docker-compose.yml 中的端口映射
- 或修改后端的启动端口

### 3. 前端无法连接后端
- 检查后端是否正常启动
- 检查 `frontend/.env` 中的 `VITE_API_BASE_URL` 配置
- 检查 CORS 配置

---

## 开发模式

后端支持热重载，代码修改后自动重启。
前端使用 Vite，支持热模块替换（HMR）。

